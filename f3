#!/bin/bash
clear
show_menu(){
  
    MENU=$(tput setaf 6) 
    NUMBER=$(tput setaf 3)  
    tput civis; tput cup 4 50

    echo $MENU"***********************************************"
       tput cup 5  50
    echo  "**$NUMBER 0)$MENU Update Arch Mirrorlist"
       tput cup 6 50
    echo  "**$NUMBER 1)$MENU Show last 20 packages installed"
       tput cup 7 50  
    echo  "**$NUMBER 2)$MENU List packages marked for upgrade with their download size"
       tput cup 8 50
    echo  "**$NUMBER 3)$MENU List all explicitly installed packages:"
       tput cup 9 50	
    echo  "**$NUMBER 4)$MENU List all native packages (installed from the sync database(s)):"
       tput cup 10 50
    echo  "**$NUMBER 5)$MENU Update Arch Packages"
       tput cup 11 50
    echo  "**$NUMBER 6)$MENU List all installed packages and their individual sizes"
       tput cup 12 50
    echo  "**$NUMBER 7)$MENU List all installed packages unrequired by other packages and which are not"
       tput cup 13 50    
    echo  "**    in the base or base-devel groups with descriptions"
       tput cup 14 50
    echo "**$NUMBER 8)$MENU For recursively removing orphans and their configuration files"
       tput cup 15 50
    echo  "**$NUMBER 9)$MENU Show the tree of local installed packages"
       tput cup 16 50
    echo  "***********************************************"
       tput cup 18 49 
    echo  "$NUMBER Please enter a menu option or $(tput setaf 1)X to exit."
    read -sn1 opt 
}
function option_picked(){
    tput cup 1 50	
    COLOR='\033[01;31m' # bold red
    RESET='\033[00;00m' # normal white
    MESSAGE=${@:-"${RESET}Error: No message passed"}
    echo -e "${COLOR}${MESSAGE}${RESET}"
}

while [[ $opt != 'X' ]]; do
   case $opt in
  
        0) option_picked "Option 0 Picked"
 	   sudo reflector -c "GB" -f 12 -l 10 -n 12 --save /etc/pacman.d/mirrorlist
	   echo "Arch Linux mirrorlist generated by Reflector"
           show_menu
           ;;
   
        1) option_picked "Option 1 Picked"
	   expac --timefmt='%Y-%m-%d %T' '%l\t%n' | sort | tail -n 20 | less
           show_menu
           ;;

        2) option_picked "Option 2 Picked"
	   tput cup 19 0           
	   pacman -Quq|xargs expac -S -H M '%k\t%n' ; pacman -Qu 
	   show_menu
           ;;

        3) option_picked "Option 3 Picked"
	   pacman -Qe | less
	   show_menu
           ;;

        4) option_picked "Option 4 Picked"
	   pacman -Qn | less
           show_menu
           ;;

	5) option_picked "Option 5 Picked"
	   tput cup 19 0
           sudo pacman -Syu
	   show_menu
	   ;;
	
	6) option_picked "Option 6 Picked"
           pacman -Qi | awk '/^Name/{name=$3} /^Installed Size/{print $4$5, name}' | sort -h | less
	   show_menu
           ;;

        7) option_picked "Option 7 Picked"
           expac -HM '%-20n\t%10d' $(comm -23<(pacman -Qqt | sort)<(pacman -Qqg base base-devel | sort)) | less
	   show_menu
           ;;

	8) option_picked "Option 8 Picked"
	   tput cup 19 0
	   sudo pacman -Rns $(pacman -Qtdq)
           show_menu
           ;;

        9) option_picked "Option 9 Picked"
           pacman -Qi | less 
           show_menu
           ;;

        x) exit
           ;;

        *) tput blink
	   option_picked "Pick an option from the menu"
           show_menu
           ;;
 
esac
tput cnorm; tput sgr0; clear
done

